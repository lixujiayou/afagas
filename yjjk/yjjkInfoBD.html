<!doctype html>
<html>

	<head>
		<meta charset="utf-8">
		<title></title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<link href="../css/mui.css" rel="stylesheet" />
		<link href="../css/mui.min.css" rel="stylesheet" />
		<link href="../css/userStyle.css" rel="stylesheet" />
		<script type="text/javascript" src="../js/common.js"></script>
	</head>

	<body>
		<header class="mui-bar mui-bar-nav">
			<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
			<h1 class="mui-title">油机监控模块绑定</h1>
		</header>

		<div class="mui-content">
			<div class="p20" style="margin-bottom: 20px;">
				<div class="user-con-box mb20">
					<ul class="mui-table-view mui-grid-view">
						<li class="mui-hidden">
							<label for="intId" style="text-align: center;line-height: 40px;">ID：</label>
							<input id="intId" style="font-size:14px; width: 60%; height: 40px;" readonly="true" />
						</li>
						<li>
							<label for="yjtype" class="mui-table-view-cell mui-media mui-col-xs-4" style="font-size: 13px;">油机类型：</label>
							<input id="yjtype" class="mui-table-view-cell mui-media mui-col-xs-8" style="height: 30px;font-size: 13px;" readonly="true" />
						</li>
						<li>
							<label for="devicename" class="mui-table-view-cell mui-media mui-col-xs-4" style="font-size: 13px;">设备名称：</label>
							<input id="devicename" class="mui-table-view-cell mui-media mui-col-xs-8" style="height: 30px;font-size: 13px;" readonly="true" />
						</li>
						<li>
							<label for="yjcode" class="mui-table-view-cell mui-media mui-col-xs-4" style="font-size: 13px;">油机编号：</label>
							<input id="yjcode" class="mui-table-view-cell mui-media mui-col-xs-8" style="height: 30px;font-size: 13px;" readonly="true" />
						</li>
						<li>
							<label for="devicecode" class="mui-table-view-cell mui-media mui-col-xs-4" style="font-size: 13px;">设备编号：</label>
							<input id="devicecode" class="mui-table-view-cell mui-media mui-col-xs-8" style="height: 30px;font-size: 13px;" readonly="true" />
						</li>
						<li>
							<label for="yjmodel" class="mui-table-view-cell mui-media mui-col-xs-4" style="font-size: 13px;">油机型号：</label>
							<input id="yjmodel" class="mui-table-view-cell mui-media mui-col-xs-8" style="height: 30px;font-size: 13px;" readonly="true" />
						</li>
						<li>
							<label for="manufacturer" class="mui-table-view-cell mui-media mui-col-xs-4" style="font-size: 13px;">制造厂家：</label>
							<input id="manufacturer" class="mui-table-view-cell mui-media mui-col-xs-8" style="height: 30px;font-size: 13px;" readonly="true" />
						</li>
						<li>
							<label for="syds" class="mui-table-view-cell mui-media mui-col-xs-4" style="font-size: 13px;">所属地市：</label>
							<input id="syds" class="mui-table-view-cell mui-media mui-col-xs-8" style="height: 30px;font-size: 13px;" readonly="true" />
						</li>
						<li>
							<label for="syqx" class="mui-table-view-cell mui-media mui-col-xs-4" style="font-size: 13px;">所属区县：</label>
							<input id="syqx" class="mui-table-view-cell mui-media mui-col-xs-8" style="height: 30px;font-size: 13px;" readonly="true" />
						</li>
						<li>
							<label for="sydept" class="mui-table-view-cell mui-media mui-col-xs-4" style="font-size: 13px;">所属部门：</label>
							<input id="sydept" class="mui-table-view-cell mui-media mui-col-xs-8" style="height: 30px;font-size: 13px;" readonly="true" />
						</li>
						<li>
							<label for="sydwcompany" class="mui-table-view-cell mui-media mui-col-xs-4" style="font-size: 13px;">所属代维公司：</label>
							<input id="sydwcompany" class="mui-table-view-cell mui-media mui-col-xs-8" style="height: 30px;font-size: 13px;" readonly="true" />
						</li>
						<li>
							<label for="yjstatus" class="mui-table-view-cell mui-media mui-col-xs-4" style="font-size: 13px;">油机状态：</label>
							<input id="yjstatus" class="mui-table-view-cell mui-media mui-col-xs-8" style="height: 30px;font-size: 13px;" readonly="true" />
						</li>
						<li>
							<label for="cqsx" class="mui-table-view-cell mui-media mui-col-xs-4" style="font-size: 13px;">产权属性：</label>
							<input id="cqsx" class="mui-table-view-cell mui-media mui-col-xs-8" style="height: 30px;font-size: 13px;" readonly="true" />
						</li>
						<li>
							<label for="useoiltype" class="mui-table-view-cell mui-media mui-col-xs-4" style="font-size: 13px;">用油类型：</label>
							<input id="useoiltype" class="mui-table-view-cell mui-media mui-col-xs-8" style="height: 30px;font-size: 13px;" readonly="true" />
						</li>
						<li>
							<label for="ratedpower" class="mui-table-view-cell mui-media mui-col-xs-4" style="font-size: 13px;">额定功率：</label>
							<input id="ratedpower" class="mui-table-view-cell mui-media mui-col-xs-8" style="height: 30px;font-size: 13px;" readonly="true" />
						</li>
						<li>
							<label for="normoilwear" class="mui-table-view-cell mui-media mui-col-xs-4" style="font-size: 13px;">标准油耗：</label>
							<input id="normoilwear" class="mui-table-view-cell mui-media mui-col-xs-8" style="height: 30px;font-size: 13px;" readonly="true" />
						</li>
						<li>
							<label for="ratedconsumption" class="mui-table-view-cell mui-media mui-col-xs-4" style="font-size: 13px;">额定功耗：</label>
							<input id="ratedconsumption" class="mui-table-view-cell mui-media mui-col-xs-8" style="height: 30px;font-size: 13px;" readonly="true" />
						</li>
						<li>
							<label for="storageplace" class="mui-table-view-cell mui-media mui-col-xs-4" style="font-size: 13px;">存放地点：</label>
							<input id="storageplace" class="mui-table-view-cell mui-media mui-col-xs-8" style="height: 30px;font-size: 13px;" readonly="true" />
						</li>
						<li>
							<label for="dutyperson" class="mui-table-view-cell mui-media mui-col-xs-4" style="font-size: 13px;">责任人：</label>
							<input id="dutyperson" class="mui-table-view-cell mui-media mui-col-xs-8" style="height: 30px;font-size: 13px;" readonly="true" />
						</li>
						<li>
							<label for="remark" class="mui-table-view-cell mui-media mui-col-xs-4" style="font-size: 13px;">备注：</label>
							<input id="remark" class="mui-table-view-cell mui-media mui-col-xs-8" style="height: 30px;font-size: 13px;" readonly="true" />
						</li>
						<li>
							<label for="collectorid" class="mui-table-view-cell mui-media mui-col-xs-4" style="font-size: 13px;">油机监控采集器ID：</label>
							<input id="collectorid" class="mui-table-view-cell mui-media mui-col-xs-8" style="height: 30px;font-size: 13px;" placeholder="未绑定油机监控模块"
							 readonly="true" />
						</li>
						<li id="btn">
							<button id="button" style="width: 20%; margin-left: 40%;">扫码</button>
						</li>
					</ul>
				</div>
			</div>
		</div>

		<footer id="foot_btn" class="mui-bar mui-bar-footer" style="position: fixed; bottom: 0; left: 0;right: 0; height: 60px;">
			<button id="btn_save" class="btn btn-primary btn-block" style="width: 45%;float:left;margin-left: 3%;margin-top: 4%;">绑定</button>
			<button id="btn_cancel" class="btn btn-default btn-block" style="width: 45%;float:left;margin-left: 3%;margin-top: 4%;">取消</button>
		</footer>
	</body>
	<script src="../js/mui.js"></script>
	<script type="text/javascript">
		/* mui.init({
			preloadPages:[{
				id: 'barcode',
				url: 'barcode.html'
			}]
		}); */
	</script>
	<script type="text/javascript">
		// 		function clickButton() {
		// 			mui.openWindow({
		// 				id: 'barcode'
		// 			});
		// 		}
	</script>
	<script type="text/javascript">
		(function($, win, doc) {
			var collect ;
			var btn ;
			var btn_save ;
			var btn_cancel;
			
			if (win.plus) {
				plusReady();
			} else {
				document.addEventListener('plusready', plusReady, false);
			}

			var barcode = null;
			var barcodePage = null;
			var time = 0;

			function plusReady() {
				 collect = doc.getElementById("collectorid");
			 btn = doc.getElementById('button');
			 btn_save = doc.getElementById('btn_save');
			 btn_cancel = doc.getElementById('btn_cancel');
				
				
				var cv = plus.webview.currentWebview();
				doc.getElementById('intId').value = cv.intId;
				document.getElementById("yjtype").value = cv.yjType;
				document.getElementById("devicename").value = cv.deviceName;
				document.getElementById("yjcode").value = cv.yjCode;
				document.getElementById("devicecode").value = cv.deviceCode;
				document.getElementById("yjmodel").value = cv.yjModel;
				document.getElementById("manufacturer").value = cv.manuFacturer;
				document.getElementById("syds").value = cv.syDs;
				document.getElementById("syqx").value = cv.syQx;
				document.getElementById("sydept").value = cv.syDept;
				document.getElementById("sydwcompany").value = cv.syDwCompany;
				document.getElementById("yjstatus").value = cv.yjStatus;
				document.getElementById("cqsx").value = cv.cqsx;
				document.getElementById("useoiltype").value = cv.useOilType;
				document.getElementById("ratedpower").value = cv.ratedPower;
				document.getElementById("normoilwear").value = cv.normOilWear;
				document.getElementById("ratedconsumption").value = cv.ratedConsumption;
				document.getElementById("storageplace").value = cv.storagePlace;
				document.getElementById("dutyperson").value = cv.dutyPerson;
				document.getElementById("remark").value = cv.remark;
				if (cv.collectorid != "") {
					document.getElementById("collectorid").value = cv.collectorid;
				}
				// 				document.addEventListener("info", function(event) {
				// 					// console.log(event.detail.yjType);
				// 					doc.getElementById('intId').value = event.detail.intId;
				// 					document.getElementById("yjtype").value = event.detail.yjType;
				// 					document.getElementById("devicename").value = event.detail.deviceName;
				// 					document.getElementById("yjcode").value = event.detail.yjCode;
				// 					document.getElementById("devicecode").value = event.detail.deviceCode;
				// 					document.getElementById("yjmodel").value = event.detail.yjModel;
				// 					document.getElementById("manufacturer").value = event.detail.manuFacturer;
				// 					document.getElementById("syds").value = event.detail.syDs;
				// 					document.getElementById("syqx").value = event.detail.syQx;
				// 					document.getElementById("sydept").value = event.detail.syDept;
				// 					document.getElementById("sydwcompany").value = event.detail.syDwCompany;
				// 					document.getElementById("yjstatus").value = event.detail.yjStatus;
				// 					document.getElementById("cqsx").value = event.detail.cqsx;
				// 					document.getElementById("useoiltype").value = event.detail.useOilType;
				// 					document.getElementById("ratedpower").value = event.detail.ratedPower;
				// 					document.getElementById("normoilwear").value = event.detail.normOilWear;
				// 					document.getElementById("ratedconsumption").value = event.detail.ratedConsumption;
				// 					document.getElementById("storageplace").value = event.detail.storagePlace;
				// 					document.getElementById("dutyperson").value = event.detail.dutyPerson;
				// 					document.getElementById("remark").value = event.detail.remark;
				// 					if (event.detail.collectorid != "") {
				// 						document.getElementById("collectorid").value = event.detail.collectorid;
				// 					}
				// 				});
				doc.addEventListener('update', function(event) {
					console.log('update');
					doc.getElementById('collectorid').value = event.detail.collectorid;
					doc.getElementById('btn').classList.add('mui-hidden');
				});
				btn_save.addEventListener('tap', function() {
					var updateurl = plus.storage.getItem("url") + "plugins/toilMonitor/toilmonitor/updateOilMachine.ilf";
					// var searchurl = "http://192.168.137.1:8080/persite/plugins/toilMonitor/toilmonitor/findMui.ilf";
					$.ajax({
						url: updateurl,
						type: 'post',
						dataType: 'json',
						data: {
							monitorId: doc.getElementById("collectorid").value,
							intId: doc.getElementById('intId').value,
							yjCode: doc.getElementById('yjcode').value
						},
						success: function(response) {
							var str = JSON.stringify(response);
							var result = JSON.parse(str);
							if (result.success == true) {
								doc.getElementById('collectorid').value = '';
								doc.getElementById('btn').classList.remove('mui-hidden');
								var parent_web = plus.webview.currentWebview().opener();
								alert(result.message);
								parent_web.reload();
								mui.back();
							} else {
								mui.toast(result.message);
								doc.getElementById('btn').classList.remove('mui-hidden');
							}
						},
						error: function(response) {
							mui.toast('绑定失败');
						}
					});
				});
				btn_cancel.addEventListener('tap', function() {
					doc.getElementById('btn').classList.remove('mui-hidden');
					doc.getElementById('collectorid').value = '';
					mui.back();
				});
				/* btn.addEventListener('tap', function() {
					time = time + 1;
					if (!barcodePage) {
						barcodePage = plus.webview.getWebviewById('barcode');
					}
					mui.fire(barcodePage, 'show', {
						time: time
					});
// 					mui.openWindow({
// 						id: 'barcode'
// 					});
					barcodePage.show();
				}); */
				btn.addEventListener('tap', function() {
					createWithoutTitle('barcode.html', {
						titleNView: {
							type: 'transparent',
							titleText: '扫一扫',
							autoBackButton: true,
							buttons: [{
								fontSrc: '_www/helloh5.ttf',
								text: '\ue302',
								fontSize: '18px',
								onclick: 'javascript:scanPicture()'
							}]
						}
					});
				});
			}

		})(mui, window, document);
	</script>

</html>
